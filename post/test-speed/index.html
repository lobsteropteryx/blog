<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>Test Speed&middot; Notes from the Lifeboat</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Ian Firkin">
	<meta name="description" content="Dim interlocutions">
	
	<meta name="generator" content="Hugo 0.42" />

	<!-- CSS -->
	<link rel="stylesheet" href="https://notesfromthelifeboat.com/css/main.css">
	<link rel="stylesheet" href="https://notesfromthelifeboat.com/css/syntax.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="https://notesfromthelifeboat.com/favicon.ico" type="image/x-icon">

	<!-- RSS -->
	

	<!-- Font Awesome -->
	<link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
	<header class="site-header">
	<div class="branding">
		<a href="https://notesfromthelifeboat.com/">
		<img class="avatar" src="https://notesfromthelifeboat.com/img/avatar.png" alt=""/>
		</a>
		<h1 class="site-title">
			<a href="https://notesfromthelifeboat.com/">Notes from the Lifeboat</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			<li><a href="/about/"> About </a></li>

			<li class="icon">
	<a href="https://notesfromthelifeboat.com/" title="">
		<i class="fa fa-fw fa-home"></i>
	</a>
</li>

<li class="icon">
	<a href="https://notesfromthelifeboat.com/index.xml" title="Subcribe">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>

<li class="icon">
	<a href="mailto:ian.firkin@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>











<li class="icon">
	<a href="https://github.com/lobsteropteryx" title="GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>



















<li class="icon">
	<a href="https://twitter.com/lobsteropteryx" title="Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>









		</ul>
	</nav>
</header>


	<div class="content">
	<article>
		<header>
			<h1 class="title">Test Speed</h1>
			<p class="meta">
	January 27, 2018 &middot; 2 minute read

	
</p>

		</header>

		<section class="post-content">
			

<p>I recently did some work on a somewhat neglected C# code base; the basic function of the application was to pull down some custom reports from a third-party web API, parse the results, and store them in a database.  There were a few obvious design problems, and the application hadn&rsquo;t been built or deployed in years, but it did include a small test suite&ndash;around 50 unit tests, written with Microsoft&rsquo;s <a href="https://github.com/Microsoft/testfx">testing framework</a>.</p>

<p>I was able to get the project to compile without too much trouble, but when I ran the test suite, I was shocked&ndash;the run time for those 50 tests was around ten minutes!  At first I thought that the tests might be integrated tests in disguise&ndash;hitting the production API and database&ndash;but all the tests seemed to be mocking out everything appropriately, using the <a href="https://github.com/moq/moq4">Moq</a> framework.</p>

<p>The answer turned out to be some throttling logic, based on default configuration values.  Included in the configuration settings was a value indicating how long the application should wait between requesting customer reports&ndash;30 seconds.  In production this didn&rsquo;t matter a great deal&ndash;the reports were pulled down nightly, as a scheduled task.  The test suite was another matter, though&ndash;this setting didn&rsquo;t affect every test, but it pushed several tests into the minute range for run time.</p>

<h2 id="the-solution">The Solution</h2>

<p>The project was using a <a href="https://www.dotnetperls.com/settings">settings</a> file to specify configuration values; the configuration file gets wrapped in a class automatically, and the values can be changed at runtime.  By using the <a href="https://msdn.microsoft.com/en-us/library/microsoft.visualstudio.testtools.unittesting.assemblyinitializeattribute.aspx"><code>AssemblyInitialize</code></a> annotation, I was able to set the timeout value to zero during the test runs:</p>
<div class="highlight"><pre class="chroma"><code class="language-C#" data-lang="C#"><span class="na">[TestClass]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TestInitialization</span>
<span class="p">{</span><span class="na">
</span><span class="na">    [AssemblyInitialize]</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">BeforeEach</span><span class="p">(</span><span class="n">TestContext</span> <span class="n">testContext</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Properties</span><span class="p">.</span><span class="n">Settings</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">CustomerReportAccessDelayInSeconds</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Doing this brought the total runtime for the test suite down to 20 seconds&ndash;not great, but not bad for C#!</p>

<h2 id="the-takeaway-keep-things-fast">The Takeaway:  Keep things Fast!</h2>

<p>This might seem like an obvious fix, but the original developers lived with a ten minute test suite, and thought that was normal.  Twenty seconds seems fast in comparison, but for a typical Ruby or Python test suite, I&rsquo;d expect to do at <em>least</em> an order of magnitude better.  Faster is always preferable, but the context is obviously going to make a difference.</p>

<p>In general, when it comes to TDD, anything longer than a few seconds will have me looking to optimize&ndash;either looking at my design, checking my tooling, or for very large suites, by running a subset of tests.</p>


			
				<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "notesfromthelifeboat" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
			
		</section>
	</article>
	</div>

	<footer class="site-footer">
	<p class="text">&copy; 2020 - Released under the MIT license<br>Powered by <a href="//gohugo.io/">Hugo</a> with the <a href="//github.com/digitalcraftsman/hugo-type-theme">Type Theme</a></p>
</footer>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-27980065-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>
</html>
